language: c

install: true

branches:
  only:
    - master
    - develop

sudo: required

services:
    - docker

before_install:
    - docker build -t api .
    - docker run -d -p 6379:6379 api
    - docker container list
    - sudo add-apt-repository -y ppa:snaipewastaken/ppa
    - sudo apt-get update -q
    - sudo apt-get install criterion-dev -y
    - git clone https://github.com/redis/hiredis.git && cd hiredis && make && sudo make install && sudo ldconfig
    - cd ..

script:
    - make clean
    - make
    - make -C tests/trie_tests
    - tests/trie_tests/test-trie
    - make -C tests/zset_tests
    - tests/zset_tests/test-zset
